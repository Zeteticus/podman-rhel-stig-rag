[Unit]
Description=RHEL STIG RAG Pod
Documentation=https://github.com/your-username/podman-rhel-stig-rag
Wants=network-online.target
After=network-online.target
RequiresMountsFor=%t/containers

[Service]
Environment=PODMAN_SYSTEMD_UNIT=%n
Environment=ENABLE_CGROUPS_COMPAT=1
Environment=MALLOC_ARENA_MAX=2
TimeoutStartSec=90
TimeoutStopSec=70
Restart=on-failure
RestartSec=10

# Container management
ExecStartPre=/bin/rm -f %t/%n.ctr-id
ExecStart=/usr/bin/podman pod start stig-rag-pod
ExecStop=/usr/bin/podman pod stop -t 20 stig-rag-pod
ExecStopPost=/bin/rm -f %t/%n.ctr-id

# Process management
Type=forking
PIDFile=%t/%n.pid

# Security hardening
ProtectSystem=strict
ProtectHome=read-only
PrivateTmp=true
PrivateDevices=true
NoNewPrivileges=true
MemoryDenyWriteExecute=true
LockPersonality=true
RestrictRealtime=true
RestrictSUIDSGID=true
SystemCallFilter=@system-service
SystemCallErrorNumber=EPERM

[Install]
WantedBy=default.target